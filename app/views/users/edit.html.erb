<% if @user.present? %>
  <%= turbo_stream_from "profile_#{@user.id}" %>

  <div class="container">
    <h1 class="text-white">Edit Your Profile</h1>

    <!-- Display success message if available -->
    <% if flash[:notice] %>
      <div class="alert alert-success">
        <%= flash[:notice] %>
      </div>
    <% end %>

    <!-- Profile Card for Edit Form -->
    <div class="card mt-4">
      <div class="card-body">
        <!-- Profile Picture and Username Section -->
        <div class="d-flex flex-column align-items-center mb-4">

          <!-- Check if user has a profile picture -->
          <div class="profile-pic-container mb-3">
            <% if @user.profile_picture.attached? %>
              <%= image_tag @user.profile_picture.url, alt: "Profile Picture", class: "rounded-circle profile-pic", width: "100", height: "100" %>
            <% else %>
              <!-- Use placeholder URL if no profile picture is attached -->
              <%= image_tag "https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541", alt: "Default Avatar", class: "rounded-circle profile-pic", width: "100" %>
            <% end %>
          </div>
        </div>

        <!-- Form Starts Here -->
        <%= form_with model: @user, url: user_path(@user), method: :patch, local: false do |form| %>

          <!-- First Name -->
          <div class="form-group">
            <%= form.label :first_name, class: 'text-primary' %>
            <%= form.text_field :first_name, class: 'form-control' %>
          </div>

          <!-- Last Name -->
          <div class="form-group">
            <%= form.label :last_name, class: 'text-primary' %>
            <%= form.text_field :last_name, class: 'form-control' %>
          </div>

          <!-- Email -->
          <div class="form-group">
            <%= form.label :email, class: 'text-primary' %>
            <%= form.email_field :email, class: 'form-control' %>
          </div>

         <!-- Profile Picture -->
<div class="form-group">
  <%= form.label :profile_picture, class: 'text-primary' %>

  <!-- Profile Picture Preview -->
<!--  <div class="mt-3">
    <% if @user.profile_picture.attached? %>
      <%= image_tag @user.profile_picture.url, class: 'img-fluid img-thumbnail rounded-circle', id: 'profile-picture-preview', style: 'width: 200px; height: 200px; object-fit: cover;' %>
    <% else %>
      <%= image_tag "https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541", class: 'img-fluid img-thumbnail rounded-circle', id: 'profile-picture-preview', style: 'width: 100px; height: 100px; object-fit: cover;' %>
    <% end %>
  </div>
</div>
-->
<div class="custom-file mt-4 mb-4">
  <%= form.file_field :profile_picture, class: 'custom-file-input d-none', id: 'profile_picture_input' %>
  <label for="profile_picture_input" class="btn btn-outline-primary rounded-pill text-white">Upload New Picture</label>
</div>

 <!-- Image Preview -->
    <div id="avatar_preview_container">
      <%= image_tag(@user.profile_picture, id: "avatar_preview", style: "max-width: 200px; max-height: 200px;") if @user.profile_picture.attached? %>
    </div>
  </div>

<!-- New Password with Margin Top -->
<div class="form-group mt-4"> <!-- Added mt-4 for margin top -->
  <%= form.label :password, 'New Password', class: 'text-primary' %>
  <%= form.password_field :password, class: 'form-control' %>
</div>

                <!-- Confirm New Password -->
          <div class="form-group">
            <%= form.label :password_confirmation, 'Confirm New Password', class: 'text-primary' %>
            <%= form.password_field :password_confirmation, class: 'form-control' %>
          </div>

          <!-- Submit Button with more spacing -->
          <div class="form-group mt-4">  <!-- mt-4 adds margin-top -->
            <%= form.submit 'Update Profile', class: 'btn btn-primary btn-lg rounded-pill shadow-sm mb-3' %>
          </div>


        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <!-- Message when user is not found or logged in -->
  <div class="alert alert-danger">
    User not found or you are not logged in. Please log in again.
  </div>
<% end %>

<div id="error_message"></div>
